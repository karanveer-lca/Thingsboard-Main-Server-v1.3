{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "avantec_widgets.update_shared_integer_attribute_with_segmented_switch_",
    "name" : "Update shared string attribute with segmented switch ",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "latest",
      "sizeX" : 7.5,
      "sizeY" : 3,
      "resources" : [ ],
      "templateHtml" : "<div class=\"tb-rpc-button\" fxLayout=\"column\">\r\n    <div fxFlex=\"{{showTitle ? 20 : 0}}\" [ngStyle]=\"{paddingTop: showTitle ? '5px': '0px'}\"\r\n        class=\"title-container\" fxLayout=\"row\"\r\n        fxLayoutAlign=\"start center\" [fxShow]=\"showTitle\">\r\n        <span class=\"button-title\">{{titleTemplate}}</span>\r\n    </div>\r\n    <div fxFlex=\"{{showTitle ? 80 : 100}}\" [ngStyle]=\"{paddingTop: showTitle ? '0px': '0px'}\"\r\n        class=\"button-container\" fxLayout=\"{{optionStyle?.orientation}}\" fxLayoutAlign=\"center center\"> \r\n            <button mat-button *ngFor=\"let x of options\" (click)=\"updateAttribute(x)\"\r\n                [class.mat-raised-button]=\"optionStyle?.isRaised\"\r\n                [class.mat-mdc-raised-button]=\"optionStyle?.isRaised\"\r\n                [color]=\"(x.attributeValue===currentValue ? optionStyle?.checkedOption.isPrimary : optionStyle?.uncheckedOption.isPrimary) ? 'primary' : ''\" \r\n                [ngStyle]=\"x.attributeValue===currentValue ? customCheckedStyle : customUncheckedStyle\">\r\n                {{x?.optionLabel}}\r\n            </button>\r\n\r\n    </div>\r\n    <div class=\"error-container\" [ngStyle]=\"{'background': error?.length ? 'rgba(255,255,255,0.25)' : 'none'}\"\r\n         fxLayout=\"row\" fxLayoutAlign=\"center center\">\r\n        <span class=\"button-error\">{{ error }}</span>\r\n    </div>\r\n</div>\r\n",
      "templateCss" : ".tb-rpc-button {\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.tb-rpc-button .title-container {\r\n    font-size: 0.8em;\r\n    font-weight: normal;\r\n    white-space: nowrap;\r\n    opacity: 0.5;\r\n    margin: 0;\r\n}\r\n\r\n.tb-rpc-button .button-container div{\r\n    min-width: 80%\r\n}\r\n\r\n.tb-rpc-button .button-container .mat-button{\r\n    width: 100%;\r\n    margin: 0;\r\n}\r\n\r\n.tb-rpc-button .button-container .mat-button{\r\n    padding: 0 0px;\r\n}\r\n\r\n/* TC 20230525 */\r\n.tb-rpc-button .button-container .mat-mdc-button{\r\n    width: 100%;\r\n    margin: 0;\r\n}\r\n\r\n.tb-rpc-button .error-container {\r\n    position: absolute;\r\n    top: 2%;\r\n    right: 0;\r\n    left: 0;\r\n    z-index: 4;\r\n    height: 14px;\r\n}\r\n\r\n.tb-rpc-button .error-container .button-error {\r\n    color: #ff3315;\r\n    white-space: nowrap;\r\n}\r\n",
      "controllerScript" : "let $scope;\nlet settings;\nlet attributeService;\nlet utils;\nlet translate;\n\nself.onInit = function() {\n    self.ctx.ngZone.run(function() {\n       init(); \n       self.ctx.detectChanges(true);\n    });\n};\n\n\nfunction init() {\n\n    $scope = self.ctx.$scope;\n    attributeService = $scope.$injector.get(self.ctx.servicesMap.get('attributeService'));\n    utils = $scope.$injector.get(self.ctx.servicesMap.get('utils'));\n    translate = $scope.$injector.get(self.ctx.servicesMap.get('translate'));\n    $scope.toastTargetId = 'input-widget' + utils.guid(); // TODO: comment it?\n    settings = utils.deepClone(self.ctx.settings) || {};\n    ////settings.showLabel = utils.defaultValue(settings.showLabel, true);\n    settings.showResultMessage = utils.defaultValue(settings.showResultMessage, true);\n    ////settings.isRequired = utils.defaultValue(settings.isRequired, true);\n    $scope.settings = settings;\n    ////$scope.isValidParameter = true;\n    $scope.dataKeyDetected = false; \n    $scope.message = translate.instant('widgets.input-widgets.no-entity-selected');\n    \n    //// $scope.requiredErrorMessage = utils.customTranslation(settings.requiredErrorMessage, settings.requiredErrorMessage) || translate.instant('widgets.input-widgets.entity-attribute-required');\n    //// $scope.labelValue = utils.customTranslation(settings.labelValue, settings.labelValue) || translate.instant('widgets.input-widgets.value');\n\n    if (settings.widgetTitle && settings.widgetTitle.length) {\n        $scope.titleTemplate = utils.customTranslation(settings.widgetTitle, settings.widgetTitle);\n        //} else {\n        //    $scope.titleTemplate = self.ctx.widgetConfig.title;\n    }\n    $scope.showTitle = settings.widgetTitle && settings.widgetTitle.length ? true : false;\n    $scope.options = settings.options;\n    $scope.optionStyle = settings.optionStyle;\n\n    $scope.customCheckedStyle = {};\n    $scope.customCheckedStyle['min-width'] = '40px';\n    $scope.customCheckedStyle['padding']   = '0 2px';\n    if (settings.optionStyle.orientation === 'column') {\n        $scope.customCheckedStyle['width']     = '100%';\n        $scope.customCheckedStyle['margin']    = 0;\n    } else {\n        $scope.customCheckedStyle['width']     = 100/settings.options.length + '%';\n        $scope.customCheckedStyle['margin']    = 0;\n    }\n    if (settings.optionStyle.checkedOption.isPrimary === false) {\n        $scope.customCheckedStyle['background-color']  = $scope.optionStyle.checkedOption.bgColor;\n        $scope.customCheckedStyle['color']             = $scope.optionStyle.checkedOption.textColor;\n    }\n\n    $scope.customUncheckedStyle = {};\n    $scope.customUncheckedStyle['min-width'] = '40px';\n    $scope.customUncheckedStyle['padding']   = '0 2px';\n    if (settings.optionStyle.orientation === \"column\") {\n        $scope.customUncheckedStyle['width']     = '100%';\n        $scope.customUncheckedStyle['margin']    = 0;\n    } else {\n        $scope.customUncheckedStyle['width']     = 100/settings.options.length + '%';\n        $scope.customUncheckedStyle['margin']    = 0;\n    }\n    if (settings.optionStyle.uncheckedOption.isPrimary === false) {\n        $scope.customUncheckedStyle['background-color']  = $scope.optionStyle.uncheckedOption.bgColor;\n        $scope.customUncheckedStyle['color']             = $scope.optionStyle.uncheckedOption.textColor;\n    }\n    \n    // var validators = [\n    //     $scope.validators.min(settings.minValue),\n    //     $scope.validators.max(settings.maxValue),\n    //     $scope.validators.pattern(/^-?[0-9]+$/)\n    // ];\n    \n    // if (settings.isRequired) {\n    //     validators.push($scope.validators.required);\n    // }\n\n    // $scope.attributeUpdateFormGroup = $scope.fb.group({\n    //     currentValue: [undefined, validators]\n    // });\n\n    if (self.ctx.datasources && self.ctx.datasources.length) {\n        var datasource = self.ctx.datasources[0];\n        if (datasource.type === 'entity') {\n            if (datasource.entityType === 'DEVICE') {\n                if (datasource.entityType && datasource.entityId) {\n                    $scope.entityName = datasource.entityName;\n                    $scope.entityDetected = true;\n                }\n            } else {\n                $scope.message = translate.instant('widgets.input-widgets.not-allowed-entity');\n            }\n        }\n        if (datasource.dataKeys.length) {\n            if (datasource.dataKeys[0].type !== \"attribute\") {\n                ////$scope.isValidParameter = false;\n            } else {\n                $scope.currentKey = datasource.dataKeys[0].name;\n                $scope.dataKeyType = datasource.dataKeys[0].type;\n                $scope.dataKeyDetected = true;\n            }\n        }\n    }\n\n    //self.ctx.widgetTitle = utils.createLabelFromDatasource(self.ctx.datasources[0], $scope.titleTemplate);\n    \n    // update value at click a button\n    $scope.updateAttribute = function(option) {\n        $scope.isFocused = false;\n        if ($scope.entityDetected) {\n            var datasource = self.ctx.datasources[0];\n\n            attributeService.saveEntityAttributes(\n                datasource.entity.id,\n                'SHARED_SCOPE',\n                [\n                    {\n                        key: $scope.currentKey,\n                        value: option.attributeValue //$scope.attributeUpdateFormGroup.get('currentValue').value\n                    }\n                ]\n            ).subscribe(\n                function success() {\n                    $scope.originalValue = $scope.currentValue; //$scope.attributeUpdateFormGroup.get('currentValue').value;\n                    if (settings.showResultMessage) {\n                        $scope.showSuccessToast(translate.instant('widgets.input-widgets.update-successful'), 1000, 'bottom', 'left', $scope.toastTargetId);\n                    }\n                },\n                function fail() {\n                    if (settings.showResultMessage) {\n                        $scope.showErrorToast(translate.instant('widgets.input-widgets.update-failed'), 'bottom', 'left', $scope.toastTargetId);\n                    }\n                }\n            );\n        }\n    };\n\n    // $scope.changeFocus = function () {\n    //     if ($scope.currentValue === $scope.originalValue) {  // $scope.attributeUpdateFormGroup.get('currentValue').value\n    //         $scope.isFocused = false;\n    //     }\n    // }\n}\n\nself.onDataUpdated = function() {\n\n    try {\n        if ($scope.dataKeyDetected) {\n            if (!$scope.isFocused) {\n                $scope.currentValue = $scope.originalValue = self.ctx.data[0].data[0][1];\n                //$scope.attributeUpdateFormGroup.get('currentValue').patchValue(correctValue($scope.originalValue));\n                self.ctx.detectChanges();\n            }\n        }\n    } catch (e) {\n        console.log(e);\n    }\n}\n\n// function correctValue(value) {\n//     if (typeof value !== \"string\") { // \"number\"\n//         return 0;\n//     }\n//     return value;\n// }\n\nself.onResize = function() {\n\n}\n\nself.typeParameters = function() {\n    return {\n        maxDatasources: 1,\n        maxDataKeys: 1,\n        singleEntity: true\n    }\n}\n\nself.onDestroy = function() {\n\n}",
      "settingsSchema" : "{\r\n    \"schema\": {\r\n        \"type\": \"object\",\r\n        \"title\": \"Settings\",\r\n        \"properties\": {\r\n            \"widgetTitle\": {\r\n                \"title\": \"Widget title\",\r\n                \"type\": \"string\",\r\n                \"default\": \"\"\r\n            },\r\n\r\n            \"showResultMessage\":{\r\n                \"title\":\"Show result message\",\r\n                \"type\":\"boolean\",\r\n                \"default\":true\r\n            },\r\n\r\n            \"options\":{\r\n                \"type\": \"array\",\r\n                \"title\": \"Options\",\r\n                \"minItems\": 1,\r\n                \"maxItems\": 30,\r\n                \"items\": {\r\n                    \"type\": \"object\",\r\n                    \"properties\": {\r\n                        \"optionLabel\": {\r\n                            \"title\": \"Option label\",\r\n                            \"type\": \"string\",\r\n                            \"default\": \"Option label\"\r\n                        },\r\n                        \"attributeValue\": {\r\n                            \"title\": \"Attribute value\",\r\n                            \"type\": \"string\",\r\n                            \"description\": \"Attribute value.\"\r\n                        }\r\n                    }, \r\n                    \"required\": [\r\n                        \"optionLabel\",\r\n                        \"attributeValue\"\r\n                    ]\r\n                }\r\n            },\r\n            \"optionStyle\":{\r\n                \"type\": \"object\",\r\n                \"title\": \"Option Style\",\r\n                \"properties\": {\r\n                    \"orientation\": {\r\n                        \"type\": \"string\",\r\n                        \"title\": \"Orientation\",\r\n                        \"default\": \"column\"\r\n                    },\r\n                    \"isRaised\": {\r\n                        \"type\": \"boolean\",\r\n                        \"title\": \"Raised\",\r\n                        \"default\": true\r\n                    },\r\n                    \"checkedOption\": {\r\n                        \"type\": \"object\",\r\n                        \"title\": \"Checked Option Style\",\r\n                        \"properties\": {\r\n                            \"isPrimary\": {\r\n                                \"type\": \"boolean\",\r\n                                \"title\": \"Primary color\",\r\n                                \"default\": true\r\n                            },\r\n                            \"bgColor\": {\r\n                                \"type\": \"string\",\r\n                                \"title\": \"Checked option background color\",\r\n                                \"default\": null\r\n                            },\r\n                            \"textColor\": {\r\n                                \"type\": \"string\",\r\n                                \"title\": \"Checked option text color\",\r\n                                \"default\": null\r\n                            }\r\n                        }\r\n                    },\r\n                    \"uncheckedOption\": {\r\n                        \"type\": \"object\",\r\n                        \"title\": \"Unchecked Option Style\",\r\n                        \"properties\": {\r\n                            \"isPrimary\": {\r\n                                \"type\": \"boolean\",\r\n                                \"title\": \"Primary color\",\r\n                                \"default\": true\r\n                            },\r\n                            \"bgColor\": {\r\n                                \"type\": \"string\",\r\n                                \"title\": \"Unchecked option background color\",\r\n                                \"default\": null\r\n                            },\r\n                            \"textColor\": {\r\n                                \"type\": \"string\",\r\n                                \"title\": \"Unchecked option text color\",\r\n                                \"default\": null\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                \"required\": [\r\n                    \"orientation\",\r\n                    \"isRaised\",\r\n                    \"checkedOption\",\r\n                    \"uncheckedOption\"\r\n                ]\r\n            },\r\n            \r\n            \"required\": [\r\n                \"options\",\r\n                \"optionStyle\"\r\n            ]\r\n        }\r\n    },\r\n    \"form\": [\r\n        \"widgetTitle\",\r\n        \"showResultMessage\",\r\n\r\n        {\r\n            \"key\": \"options\",\r\n            \"items\": [\r\n                \"options[]\"\r\n            ]\r\n        }, \r\n        {\r\n            \"key\": \"optionStyle\",\r\n            \"items\" :[\r\n                {\r\n                    \"key\": \"optionStyle.orientation\",\r\n                    \"type\": \"rc-select\",\r\n                    \"multiple\": false,\r\n                    \"items\": [{\r\n                        \"value\": \"column\",\r\n                        \"label\": \"Column\"\r\n                    }, {\r\n                        \"value\": \"row\",\r\n                        \"label\": \"Row\"\r\n                    }]\r\n                },\r\n                \"optionStyle.isRaised\",\r\n                {\r\n                    \"key\": \"optionStyle.checkedOption\",\r\n                    \"items\": [\r\n                        \"optionStyle.checkedOption.isPrimary\",\r\n                        {\r\n                            \"key\": \"optionStyle.checkedOption.bgColor\",\r\n                            \"type\": \"color\"\r\n                        },\r\n                        {\r\n                            \"key\": \"optionStyle.checkedOption.textColor\",\r\n                            \"type\": \"color\"\r\n                        }\r\n                    ]\r\n                }, {\r\n                    \"key\": \"optionStyle.uncheckedOption\",\r\n                    \"items\": [\r\n                        \"optionStyle.uncheckedOption.isPrimary\",\r\n                        {\r\n                            \"key\": \"optionStyle.uncheckedOption.bgColor\",\r\n                            \"type\": \"color\"\r\n                        },\r\n                        {\r\n                            \"key\": \"optionStyle.uncheckedOption.textColor\",\r\n                            \"type\": \"color\"\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        }\r\n    ]\r\n}\r\n",
      "dataKeySettingsSchema" : "{}\n",
      "defaultConfig" : "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#FFFFFF\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"optionStyle\":{\"orientation\":\"column\",\"isRaised\":true,\"checkedOption\":{\"isPrimary\":true},\"uncheckedOption\":{\"isPrimary\":false,\"bgColor\":\"#e6e7e8\"}},\"options\":[{\"optionLabel\":\"Option label 0\",\"attributeValue\":\"Option label 0\"},{\"optionLabel\":\"Option label 1\",\"attributeValue\":\"Option label 1\"}],\"showResultMessage\":true},\"title\":\"Update shared string attribute with segmented switch \",\"showTitleIcon\":false,\"titleTooltip\":\"\",\"dropShadow\":true,\"enableFullscreen\":false,\"enableDataExport\":false,\"widgetStyle\":{},\"widgetCss\":\"\",\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"pageSize\":1024,\"noDataDisplayMessage\":\"\",\"showLegend\":false}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "bfea9ce1-d06a-11f0-bfb0-df6928613c13"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}