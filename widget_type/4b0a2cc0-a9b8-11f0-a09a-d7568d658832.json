{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "status",
    "name" : "Status widget new",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "latest",
      "sizeX" : 7.5,
      "sizeY" : 3,
      "resources" : [ ],
      "templateHtml" : "<!-- You can leave this empty; we build DOM in JS. Keeping a root for clarity. -->\r\n<div id=\"tb-color-root\"></div>\r\n",
      "templateCss" : ".tbColorTile {\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  transition: background-color 200ms ease;\r\n}\r\n.tbColorContent {\r\n  text-align: center;\r\n  padding: 8px 12px;\r\n}\r\n.tbColorValue {\r\n  font-size: 2.2em;\r\n  font-weight: 600;\r\n  line-height: 1.1;\r\n  word-break: break-word;\r\n}\r\n.tbColorLabel {\r\n  margin-top: 6px;\r\n  font-size: 0.9em;\r\n  opacity: 0.85;\r\n}\r\n",
      "controllerScript" : "/* ThingsBoard Custom Widget (Latest values)\r\n * Color tile + status text:\r\n *  - value === 11        → \"IN PRODUCTION\"  (OK color)\r\n *  - 1 <= value <= 10    → \"ALARM-N\"        (Dur-N palette color)\r\n *  - else / no data      → shows raw value or \"—\" (N/A color)\r\n */\r\n\r\nvar self = this;\r\n\r\nfunction removeBezel(ctx) {\r\n  ctx.$container.css({ position: 'relative', padding: 0, margin: 0, background: 'transparent' });\r\n  var $card = ctx.$container.closest('mat-card, md-card, .mat-card, .tb-widget, .tb-card');\r\n  if ($card && $card.length) {\r\n    $card.css({ padding: 0, margin: 0, border: 0, borderRadius: 0, boxShadow: 'none', background: 'transparent' });\r\n    $card.find('.mat-card-content, md-card-content, .tb-widget-body, .tb-card-content').css({ padding: 0, margin: 0 });\r\n  }\r\n}\r\n\r\n// ---- helpers ----\r\nfunction getLatest(ctx) {\r\n  var d = ctx.data && ctx.data[0];\r\n  if (!d) return undefined;\r\n  if (Array.isArray(d.data) && d.data.length) return d.data[d.data.length - 1][1]; // [ts, value]\r\n  if ('current' in d) return d.current;\r\n  if ('value' in d)   return d.value;\r\n  return undefined;\r\n}\r\n\r\nfunction isProductionValue(vRaw) {\r\n  if (vRaw === null || typeof vRaw === 'undefined') return false;\r\n  var s = String(vRaw).trim();\r\n  var n = Number(s);\r\n  return isFinite(n) && Math.abs(n - 11) < 1e-9;\r\n}\r\n\r\nfunction alarmInRange(vRaw) {\r\n  var s = String(vRaw).trim();\r\n  var n = Number(s);\r\n  if (isFinite(n) && n >= 1 && n <= 10) {\r\n    var display = Number.isInteger(n) ? String(n) : s;\r\n    return { inRange: true, n: n, display: display };\r\n  }\r\n  return { inRange: false, n: NaN, display: s };\r\n}\r\n\r\nfunction applyTitleVisibility(ctx) {\r\n  try {\r\n    ctx.hideTitlePanel = !ctx.isEdit;\r\n    if (typeof ctx.updateWidgetParams === 'function') ctx.updateWidgetParams();\r\n  } catch (e) {\r\n    var $card = ctx.$container.closest('mat-card, md-card, .mat-card, .tb-widget, .tb-card');\r\n    if ($card && $card.length) {\r\n      $card.find('mat-card-title, md-card-title, .mat-card-title, .tb-widget-title, .tb-card-title, .tb-widget-header, .mat-card-header').hide();\r\n      $card.css({ paddingTop: 0 });\r\n      $card.find('.mat-card-content, md-card-content, .tb-widget-body, .tb-card-content').css({ paddingTop: 0 });\r\n    }\r\n  }\r\n}\r\n\r\nself.onInit = function () {\r\n  var s = self.ctx.settings || {};\r\n\r\n  // Colors\r\n  // DUR palette (1..5) then repeats for 6..10: Red, Orange, Yellow, Blue, Green\r\n  self.cDur1 = s.cDur1 || '#E53935'; // DUR-1 / 6\r\n  self.cDur2 = s.cDur2 || '#FB8C00'; // DUR-2 / 7\r\n  self.cDur3 = s.cDur3 || '#FDD835'; // DUR-3 / 8\r\n  self.cDur4 = s.cDur4 || '#1E88E5'; // DUR-4 / 9\r\n  self.cDur5 = s.cDur5 || '#43A047'; // DUR-5 / 10\r\n  self.palette = [self.cDur1, self.cDur2, self.cDur3, self.cDur4, self.cDur5];\r\n\r\n  self.okColor    = s.okColor    || '#43A047'; // production (green)\r\n  self.naColor    = s.naColor    || '#455A64'; // no data / other\r\n\r\n  // UI\r\n  self.label     = s.label || '';\r\n  self.showValue = (typeof s.showValue === 'boolean') ? s.showValue : true;\r\n\r\n  // Build DOM\r\n  var tileId = 'tbColorTile-' + Math.random().toString(36).slice(2);\r\n  self.ctx.$container.append(\r\n    \"<div id='\" + tileId + \"' class='tbColorTile'>\" +\r\n      \"<div class='tbColorContent'>\" +\r\n        \"<div class='tbColorValue'></div>\" +\r\n        \"<div class='tbColorLabel'></div>\" +\r\n      \"</div>\" +\r\n    \"</div>\"\r\n  );\r\n\r\n  var $tile   = $('#' + tileId, self.ctx.$container);\r\n  var $value  = $('.tbColorValue', $tile);\r\n  var $label  = $('.tbColorLabel', $tile);\r\n\r\n  self.dom = { $tile: $tile, $value: $value, $label: $label };\r\n\r\n  // Initial UI\r\n  self.dom.$tile.css('background-color', self.naColor);\r\n  self.dom.$label.text(self.label || '');\r\n  if (!self.showValue) self.dom.$value.hide();\r\n\r\n  applyTitleVisibility(self.ctx);\r\n};\r\n\r\nself.onEditModeChanged = function () {\r\n  applyTitleVisibility(self.ctx);\r\n};\r\n\r\nself.onDataUpdated = function () {\r\n  var raw = getLatest(self.ctx);\r\n\r\n  var statusText = '—';\r\n  var bg   = self.naColor;\r\n\r\n  if (raw !== null && typeof raw !== 'undefined') {\r\n    if (isProductionValue(raw)) {\r\n      statusText = 'IN PRODUCTION';\r\n      bg   = self.okColor;\r\n    } else {\r\n      var a = alarmInRange(raw);\r\n      if (a.inRange) {\r\n        statusText = 'ALARM-' + a.display;\r\n        // DUR palette mapping: 1..5 map to palette[0..4], then repeat for 6..10\r\n        var idx = ((Math.floor(a.n) - 1) % 5 + 5) % 5; // safe modulo\r\n        bg = self.palette[idx];\r\n      } else {\r\n        statusText = String(raw).trim();\r\n        bg   = self.naColor;\r\n      }\r\n    }\r\n  }\r\n\r\n  self.dom.$tile.css('background-color', bg);\r\n  // ✨ Add the requested prefix text here:\r\n  self.dom.$value.text('Machine Status: ' + statusText);\r\n};\r\n\r\nself.onResize = function () {};\r\nself.onDestroy = function () {};\r\n\r\nself.getSettingsSchema = function () {\r\n  return {\r\n    schema: {\r\n      type: 'object',\r\n      title: 'Settings',\r\n      properties: {\r\n        label:      { title: 'Label', type: 'string',  default: '' },\r\n        showValue:  { title: 'Show value', type: 'boolean', default: true },\r\n        okColor:    { title: 'OK color (production)', type: 'string', default: '#43A047' },\r\n        naColor:    { title: 'N/A color (other)', type: 'string', default: '#455A64' },\r\n        cDur1:      { title: 'DUR-1 / DUR-6 color', type: 'string', default: '#E53935' },\r\n        cDur2:      { title: 'DUR-2 / DUR-7 color', type: 'string', default: '#FB8C00' },\r\n        cDur3:      { title: 'DUR-3 / DUR-8 color', type: 'string', default: '#FDD835' },\r\n        cDur4:      { title: 'DUR-4 / DUR-9 color', type: 'string', default: '#1E88E5' },\r\n        cDur5:      { title: 'DUR-5 / DUR-10 color', type: 'string', default: '#43A047' }\r\n      }\r\n    },\r\n    form: ['label','showValue','okColor','naColor','cDur1','cDur2','cDur3','cDur4','cDur5']\r\n  };\r\n};\r\n\r\nself.getDataKeySettingsSchema = function () {\r\n  return { schema: { type: 'object', properties: {} }, form: [] };\r\n};\r\n",
      "settingsForm" : [ ],
      "dataKeySettingsForm" : [ ],
      "defaultConfig" : "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn 4;\",\"aggregationType\":null,\"units\":null,\"decimals\":null,\"usePostProcessing\":null,\"postFuncBody\":null}],\"alarmFilterConfig\":{\"statusList\":[\"ACTIVE\"]}}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{},\"title\":\"Attributes card\",\"decimals\":null,\"useDashboardTimewindow\":true,\"displayTimewindow\":true}"
    },
    "externalId" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "4b0a2cc0-a9b8-11f0-a09a-d7568d658832"
    },
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "4b0a2cc0-a9b8-11f0-a09a-d7568d658832"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}