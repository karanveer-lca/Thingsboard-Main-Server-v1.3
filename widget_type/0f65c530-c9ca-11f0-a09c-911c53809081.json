{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "plant_view",
    "name" : "PLANT VIEW",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "static",
      "sizeX" : 7.5,
      "sizeY" : 3,
      "resources" : [ ],
      "templateHtml" : "<div class=\"fp-root\">\r\n  <!-- Toolbar: view mode tabs on the left -->\r\n  <div class=\"fp-toolbar\">\r\n    <div class=\"fp-toolbar-left\">\r\n      <button\r\n        class=\"fp-tab\"\r\n        [class.fp-tab-active]=\"viewMode === 'floorplan'\"\r\n        (click)=\"setViewMode('floorplan')\"\r\n      >\r\n        Floorplan\r\n      </button>\r\n      <button\r\n        class=\"fp-tab\"\r\n        [class.fp-tab-active]=\"viewMode === 'grid'\"\r\n        (click)=\"setViewMode('grid')\"\r\n      >\r\n        Grid\r\n      </button>\r\n      <button\r\n        class=\"fp-tab\"\r\n        [class.fp-tab-active]=\"viewMode === 'list'\"\r\n        (click)=\"setViewMode('list')\"\r\n      >\r\n        List\r\n      </button>\r\n    </div>\r\n\r\n    <div class=\"fp-toolbar-right\"></div>\r\n  </div>\r\n\r\n  <div class=\"fp-main\">\r\n    <!-- FLOORPLAN VIEW -->\r\n    <div class=\"fp-wrap\" *ngIf=\"viewMode === 'floorplan'\">\r\n      <img\r\n        class=\"fp-bg\"\r\n        [src]=\"bgUrl | image | async\"\r\n        (load)=\"onBgLoad($event)\"\r\n        alt=\"floorplan\"\r\n      />\r\n\r\n      <div\r\n        class=\"fp-label\"\r\n        *ngFor=\"let d of labels; trackBy: trackById\"\r\n        [style.left.px]=\"d.__pxLeft || 0\"\r\n        [style.top.px]=\"d.__pxTop || 0\"\r\n        (click)=\"clickDevice(d)\"\r\n        [attr.title]=\"d?.name\"\r\n      >\r\n        <div class=\"fp-card\">\r\n          <div\r\n            class=\"fp-chip\"\r\n            [ngStyle]=\"{ 'background-color': d.color || 'rgba(15,36,62,0.92)' }\"\r\n          >\r\n            {{ d?.label || d?.name }}\r\n          </div>\r\n          <!-- No telemetry in this parent widget; getTelemetryKeys() returns [] -->\r\n          <div class=\"fp-telemetry\" *ngIf=\"getTelemetryKeys(d).length > 0\">\r\n            <div class=\"fp-data-row\" *ngFor=\"let key of getTelemetryKeys(d)\">\r\n              <span class=\"fp-data-label\">{{ key.label }}:</span>\r\n              <span class=\"fp-data-value\">{{ key.displayValue }}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"fp-legend\">\r\n        <span class=\"dot dot-on\"></span> Active\r\n        <span class=\"dot dot-off\"></span> Inactive\r\n      </div>\r\n    </div>\r\n\r\n    <!-- GRID VIEW (cards styled like popup) -->\r\n    <div class=\"fp-grid-container\" *ngIf=\"viewMode === 'grid'\">\r\n      <div class=\"fp-grid-cards\">\r\n        <div\r\n          class=\"fp-grid-card\"\r\n          *ngFor=\"let d of labels; trackBy: trackById\"\r\n          (click)=\"clickDevice(d)\"\r\n        >\r\n          <!-- status dot in top-left -->\r\n          <span\r\n            class=\"fp-grid-status-dot\"\r\n            [ngStyle]=\"{\r\n              'background-color':\r\n                d.color ||\r\n                (d.isActive\r\n                  ? 'rgba(76,175,80,0.95)'\r\n                  : 'rgba(244,67,54,0.95)')\r\n            }\"\r\n          ></span>\r\n\r\n          <!-- chip like screenshot -->\r\n          <div\r\n            class=\"fp-chip fp-grid-chip\"\r\n            [ngStyle]=\"{ 'background-color': d.color || 'rgba(15,36,62,0.92)' }\"\r\n          >\r\n            {{ d?.label || d?.name }}\r\n          </div>\r\n\r\n          <!-- KPIs section hidden because getTelemetryKeys() returns [] -->\r\n          <div class=\"fp-grid-body\" *ngIf=\"getTelemetryKeys(d).length > 0\">\r\n            <div class=\"fp-data-row\" *ngFor=\"let key of getTelemetryKeys(d)\">\r\n              <span class=\"fp-data-label\">{{ key.label }}:</span>\r\n              <span class=\"fp-data-value\">{{ key.displayValue }}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- LIST VIEW -->\r\n    <div class=\"fp-list-container\" *ngIf=\"viewMode === 'list'\">\r\n      <div class=\"fp-table-wrap\" *ngIf=\"labels.length > 0\">\r\n        <table class=\"fp-table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Line</th>\r\n              <th *ngFor=\"let dk of dataKeysConfig\">\r\n                {{ dk.label || dk.key }}\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr\r\n              *ngFor=\"let d of labels; trackBy: trackById\"\r\n              (click)=\"clickDevice(d)\"\r\n            >\r\n              <td class=\"fp-table-machine\">\r\n                <span\r\n                  class=\"fp-table-dot\"\r\n                  [ngStyle]=\"{\r\n                    'background-color':\r\n                      d.color ||\r\n                      (d.isActive\r\n                        ? 'rgba(76,175,80,0.95)'\r\n                        : 'rgba(244,67,54,0.95)')\r\n                  }\"\r\n                ></span>\r\n                {{ d?.label || d?.name }}\r\n              </td>\r\n              <td *ngFor=\"let dk of dataKeysConfig\">\r\n                <!-- no telemetry, so this will be empty anyway -->\r\n                --\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <div class=\"fp-no-data\" *ngIf=\"labels.length === 0\">\r\n        No lines configured in settings.\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<style>\r\n  .fp-root {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    font-family: Arial, Helvetica, sans-serif;\r\n  }\r\n\r\n  .fp-main {\r\n    flex: 1 1 auto;\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .fp-toolbar {\r\n    flex: 0 0 auto;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    padding: 4px 8px;\r\n    background: rgba(15, 36, 62, 0.04);\r\n    border-bottom: 1px solid rgba(15, 36, 62, 0.08);\r\n  }\r\n\r\n  .fp-toolbar-left {\r\n    display: inline-flex;\r\n    gap: 4px;\r\n    align-items: center;\r\n  }\r\n\r\n  .fp-toolbar-right {\r\n    min-width: 0;\r\n  }\r\n\r\n  .fp-tab {\r\n    border-radius: 999px;\r\n    padding: 4px 10px;\r\n    border: 1px solid transparent;\r\n    background: transparent;\r\n    font-size: 11px;\r\n    font-weight: 600;\r\n    cursor: pointer;\r\n    color: #3d4b63;\r\n    outline: none;\r\n    transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease;\r\n  }\r\n\r\n  .fp-tab:hover {\r\n    background: rgba(15, 36, 62, 0.06);\r\n  }\r\n\r\n  .fp-tab-active {\r\n    background: #0f243e;\r\n    border-color: #0f243e;\r\n    color: #ffffff;\r\n  }\r\n\r\n  /* FLOORPLAN VIEW */\r\n  .fp-wrap {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: hidden;\r\n    background: #0f243e08;\r\n  }\r\n\r\n  .fp-bg {\r\n    position: absolute;\r\n    inset: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: contain;\r\n    user-select: none;\r\n    pointer-events: none;\r\n  }\r\n\r\n  .fp-label {\r\n    position: absolute;\r\n    transform: translate(-50%, -50%);\r\n    cursor: pointer;\r\n    z-index: 10;\r\n  }\r\n\r\n  .fp-card {\r\n    background: rgba(255, 255, 255, 0.95);\r\n    border-radius: 8px;\r\n    padding: 6px;\r\n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4), 0 3px 8px rgba(0, 0, 0, 0.3);\r\n    backdrop-filter: blur(4px);\r\n    border: 1px solid rgba(255, 255, 255, 0.8);\r\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .fp-card:hover {\r\n    transform: scale(1.05);\r\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5), 0 4px 10px rgba(0, 0, 0, 0.35);\r\n  }\r\n\r\n  .fp-chip {\r\n    padding: 6px 10px;\r\n    border-radius: 6px;\r\n    color: #fff;\r\n    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.35), 0 2px 4px rgba(0, 0, 0, 0.2);\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    line-height: 1.2;\r\n    white-space: nowrap;\r\n    user-select: none;\r\n    text-align: center;\r\n    margin-bottom: 4px;\r\n  }\r\n\r\n  .fp-telemetry {\r\n    max-height: 0;\r\n    opacity: 0;\r\n    overflow: hidden;\r\n    margin-top: 0;\r\n    padding-top: 0;\r\n    border-top: 1px solid transparent;\r\n    transition:\r\n      max-height 0.3s ease,\r\n      opacity 0.3s ease,\r\n      margin-top 0.3s ease,\r\n      padding-top 0.3s ease,\r\n      border-top-color 0.3s ease;\r\n  }\r\n\r\n  .fp-card:hover .fp-telemetry {\r\n    max-height: 500px;\r\n    opacity: 1;\r\n    margin-top: 6px;\r\n    padding-top: 6px;\r\n    border-top-color: rgba(0, 0, 0, 0.1);\r\n  }\r\n\r\n  .fp-data-row {\r\n    font-size: 11px;\r\n    color: #333;\r\n    background: rgba(240, 245, 250, 0.9);\r\n    border-radius: 4px;\r\n    padding: 4px 8px;\r\n    margin-bottom: 3px;\r\n    white-space: nowrap;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n\r\n  .fp-data-row:last-child {\r\n    margin-bottom: 0;\r\n  }\r\n\r\n  .fp-data-label {\r\n    font-weight: 600;\r\n    margin-right: 8px;\r\n    color: #555;\r\n  }\r\n\r\n  .fp-data-value {\r\n    font-weight: 500;\r\n    color: #0f243e;\r\n  }\r\n\r\n  .fp-legend {\r\n    position: absolute;\r\n    right: 8px;\r\n    bottom: 8px;\r\n    background: rgba(15, 36, 62, 0.85);\r\n    color: #fff;\r\n    font-size: 11px;\r\n    padding: 8px 12px;\r\n    border-radius: 6px;\r\n    display: flex;\r\n    gap: 12px;\r\n    align-items: center;\r\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\r\n  }\r\n\r\n  .dot {\r\n    display: inline-block;\r\n    width: 10px;\r\n    height: 10px;\r\n    border-radius: 50%;\r\n    margin-right: 4px;\r\n    vertical-align: middle;\r\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.35);\r\n  }\r\n\r\n  .dot-on {\r\n    background: rgba(76, 175, 80, 0.9);\r\n  }\r\n\r\n  .dot-off {\r\n    background: rgba(244, 67, 54, 0.9);\r\n  }\r\n\r\n  /* GRID VIEW */\r\n  .fp-grid-container {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    padding: 8px 10px;\r\n    box-sizing: border-box;\r\n    background: #f4f6fb;\r\n    overflow: auto;\r\n  }\r\n\r\n  .fp-grid-cards {\r\n    display: flex;\r\n    flex-wrap: nowrap;\r\n    gap: 8px;\r\n    align-items: stretch;\r\n  }\r\n\r\n  .fp-grid-card {\r\n    position: relative;\r\n    flex: 0 0 220px;\r\n    background: #ffffff;\r\n    border-radius: 10px;\r\n    border: 1px solid #cfd7ea;\r\n    padding: 8px 8px 8px 8px;\r\n    box-shadow: 0 8px 22px rgba(15, 36, 62, 0.28);\r\n    cursor: pointer;\r\n    display: flex;\r\n    flex-direction: column;\r\n    min-height: 120px;\r\n    transition: box-shadow 0.15s ease, transform 0.15s ease;\r\n  }\r\n\r\n  .fp-grid-card:hover {\r\n    box-shadow: 0 12px 30px rgba(15, 36, 62, 0.34);\r\n    transform: translateY(-2px);\r\n  }\r\n\r\n  .fp-grid-chip {\r\n    padding-left: 20px; /* room for status dot */\r\n    font-size: 12px;\r\n  }\r\n\r\n  .fp-grid-body {\r\n    margin-top: 4px;\r\n  }\r\n\r\n  .fp-grid-status-dot {\r\n    position: absolute;\r\n    top: 11px;\r\n    left: 10px;\r\n    width: 8px;\r\n    height: 8px;\r\n    border-radius: 50%;\r\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\r\n  }\r\n\r\n  /* LIST VIEW */\r\n  .fp-list-container {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 100%;\r\n    padding: 8px;\r\n    box-sizing: border-box;\r\n    background: #eef1f8;\r\n    overflow: auto;\r\n  }\r\n\r\n  .fp-table-wrap {\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: auto;\r\n  }\r\n\r\n  .fp-table {\r\n    width: 100%;\r\n    border-collapse: collapse;\r\n    font-size: 11px;\r\n    background: #ffffff;\r\n    border-radius: 8px;\r\n    overflow: hidden;\r\n    box-shadow: 0 3px 10px rgba(15, 36, 62, 0.18);\r\n  }\r\n\r\n  .fp-table th,\r\n  .fp-table td {\r\n    padding: 7px 10px;\r\n    border-bottom: 1px solid #c2cbe2;\r\n    text-align: left;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  .fp-table th {\r\n    background: #dde4f7;\r\n    font-weight: 700;\r\n    font-size: 11px;\r\n    color: #1f2b45;\r\n    border-bottom: 1px solid #b3bedc;\r\n  }\r\n\r\n  .fp-table tr:nth-child(even) td {\r\n    background: #f7f8ff;\r\n  }\r\n\r\n  .fp-table tr:hover td {\r\n    background: #eaefff;\r\n  }\r\n\r\n  .fp-table tr:last-child td {\r\n    border-bottom: none;\r\n  }\r\n\r\n  .fp-table-machine {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    font-weight: 600;\r\n    color: #233348;\r\n  }\r\n\r\n  .fp-table-dot {\r\n    width: 9px;\r\n    height: 9px;\r\n    border-radius: 50%;\r\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);\r\n  }\r\n\r\n  .fp-no-data {\r\n    font-size: 12px;\r\n    color: #6b768c;\r\n    text-align: center;\r\n    margin-top: 16px;\r\n  }\r\n</style>\r\n",
      "templateCss" : "",
      "controllerScript" : "/* \r\n * Lines Floorplan widget (parent) for ThingsBoard PE\r\n *\r\n * - Shows \"lines\" as chips on a floorplan (each line = one DEVICE GROUP)\r\n * - Reuses the same chip / grid / list UI as the SLD floorplan widget\r\n * - On click, navigates to a target dashboard state\r\n *   and passes the entity group id via state params:\r\n *\r\n *   params.entityGroupId          = <groupId>        // always\r\n *   params[CONFIG.stateParamName] = <groupId>        // optional extra alias\r\n *   params.entityGroupLabel       = <label>          // helpful metadata\r\n *   params.entityGroupInternalId  = <id>\r\n */\r\n\r\nself.onInit = function () {\r\n  var ctx = self.ctx;\r\n  var settings = ctx.settings || {};\r\n\r\n  // ---------- SETTINGS PARSERS ----------\r\n\r\n  function parseLinesConfig(value) {\r\n    if (Array.isArray(value)) {\r\n      console.log('[LinesFP] linesConfig provided as array:', value);\r\n      return value;\r\n    } else if (typeof value === 'string' && value.trim()) {\r\n      try {\r\n        var parsed = JSON.parse(value);\r\n        console.log('[LinesFP] linesConfig parsed from JSON string:', parsed);\r\n        return parsed;\r\n      } catch (err) {\r\n        console.warn('[LinesFP] Failed to parse linesConfig JSON:', err);\r\n        return [];\r\n      }\r\n    }\r\n    return [];\r\n  }\r\n\r\n  function normalizeImageUrl(url) {\r\n    return url ? url.toString().replace(/^tb-image[:;]\\s*/i, '').trim() : '';\r\n  }\r\n\r\n  var CONFIG = {\r\n    imageUrl: settings.imageUrl || '',\r\n    lines: parseLinesConfig(settings.linesConfig),\r\n    targetStateId: settings.targetStateId || '',\r\n    stateParamName: settings.stateParamName || 'entityGroupId'\r\n  };\r\n\r\n  console.log('[LinesFP] Resolved CONFIG:', CONFIG);\r\n\r\n  // ---------- SCOPE BINDINGS ----------\r\n\r\n  var $scope = ctx.$scope;\r\n\r\n  $scope.bgUrl = '';\r\n  $scope.labels = [];\r\n  $scope.dataKeysConfig = []; // no telemetry here\r\n\r\n  $scope.trackById = function (_i, item) {\r\n    return (item && item.id) || _i;\r\n  };\r\n\r\n  // always empty; hides telemetry sections\r\n  $scope.getTelemetryKeys = function (_label) {\r\n    return [];\r\n  };\r\n\r\n  $scope.viewMode = 'floorplan';\r\n  $scope.setViewMode = function (mode) {\r\n    if (['floorplan', 'grid', 'list'].indexOf(mode) < 0) {\r\n      return;\r\n    }\r\n    $scope.viewMode = mode;\r\n    ctx.detectChanges();\r\n  };\r\n\r\n  $scope.onBgLoad = onBgLoad;\r\n  $scope.clickDevice = clickLine;\r\n\r\n  // ---------- LAYOUT STATE ----------\r\n\r\n  var layout = {\r\n    natW: 0,\r\n    natH: 0,\r\n    boxL: 0,\r\n    boxT: 0,\r\n    boxW: 0,\r\n    boxH: 0\r\n  };\r\n\r\n  function getHostRect() {\r\n    var host = ctx.$container\r\n      ? ctx.$container[0]\r\n      : ctx.$scope && ctx.$scope.$element && ctx.$scope.$element[0];\r\n\r\n    if (!host || !host.getBoundingClientRect) {\r\n      return {\r\n        left: 0,\r\n        top: 0,\r\n        width: 0,\r\n        height: 0\r\n      };\r\n    }\r\n    var r = host.getBoundingClientRect();\r\n    return {\r\n      left: r.left,\r\n      top: r.top,\r\n      width: r.width,\r\n      height: r.height\r\n    };\r\n  }\r\n\r\n  function clamp01(v) {\r\n    return v < 0 ? 0 : v > 1 ? 1 : v;\r\n  }\r\n\r\n  function recomputePixelPositions() {\r\n    var r = getHostRect();\r\n    if (!r.width || !r.height || !layout.natW || !layout.natH) {\r\n      return;\r\n    }\r\n\r\n    var s = Math.min(r.width / layout.natW, r.height / layout.natH);\r\n    layout.boxW = layout.natW * s;\r\n    layout.boxH = layout.natH * s;\r\n    layout.boxL = (r.width - layout.boxW) * 0.5;\r\n    layout.boxT = (r.height - layout.boxH) * 0.5;\r\n\r\n    ($scope.labels || []).forEach(function (d) {\r\n      var px = clamp01(+d.x / 100);\r\n      var py = clamp01(+d.y / 100);\r\n      d.__pxLeft = Math.round(layout.boxL + px * layout.boxW);\r\n      d.__pxTop = Math.round(layout.boxT + py * layout.boxH);\r\n    });\r\n\r\n    ctx.detectChanges();\r\n  }\r\n\r\n  function onBgLoad(ev) {\r\n    try {\r\n      var img = ev && ev.target ? ev.target : null;\r\n      layout.natW = (img && img.naturalWidth) || 0;\r\n      layout.natH = (img && img.naturalHeight) || 0;\r\n      console.log('[LinesFP] onBgLoad: natural size =', layout.natW, 'x', layout.natH);\r\n      recomputePixelPositions();\r\n    } catch (e) {\r\n      console.warn('[LinesFP] onBgLoad error:', e);\r\n    }\r\n  }\r\n\r\n  // ---------- BUILD LINES AS \"LABELS\" ----------\r\n\r\n  function buildLabelsFromLines(lines) {\r\n    var out = [];\r\n    if (!Array.isArray(lines)) {\r\n      return out;\r\n    }\r\n\r\n    lines.forEach(function (line, idx) {\r\n      if (!line || !line.groupId) return;\r\n\r\n      var id = line.id || line.groupId;\r\n      var name = line.label || ('Line ' + (idx + 1));\r\n      var x = typeof line.x === 'number' ? line.x : Number(line.x) || 0;\r\n      var y = typeof line.y === 'number' ? line.y : Number(line.y) || 0;\r\n\r\n      out.push({\r\n        id: id,\r\n        name: name,\r\n        label: name,\r\n        groupId: line.groupId,\r\n        x: x,\r\n        y: y,\r\n        __pxLeft: 0,\r\n        __pxTop: 0,\r\n        // treat all lines as \"active\" to get green dots in grid/list\r\n        isActive: true,\r\n        color: line.color || null\r\n      });\r\n    });\r\n\r\n    console.log(\r\n      '[LinesFP] Labels built (lines):',\r\n      out.map(function (l) {\r\n        return l.name + ' -> ' + l.groupId;\r\n      })\r\n    );\r\n\r\n    return out;\r\n  }\r\n\r\n  function applyConfig() {\r\n    if (!CONFIG.imageUrl) {\r\n      console.warn('[LinesFP] imageUrl setting is empty.');\r\n    }\r\n    if (!CONFIG.lines || !CONFIG.lines.length) {\r\n      console.warn('[LinesFP] linesConfig setting is empty. Nothing to render.');\r\n    }\r\n\r\n    var normImg = normalizeImageUrl(CONFIG.imageUrl);\r\n    $scope.bgUrl = normImg;\r\n    $scope.labels = buildLabelsFromLines(CONFIG.lines);\r\n\r\n    // let layout settle before computing positions\r\n    setTimeout(function () {\r\n      recomputePixelPositions();\r\n    }, 0);\r\n\r\n    ctx.detectChanges();\r\n  }\r\n\r\n  // ---------- NAVIGATION ----------\r\n\r\n  function clickLine(label) {\r\n    var sc = ctx.stateController;\r\n    if (!sc || typeof sc.updateState !== 'function') {\r\n      console.warn('[LinesFP] State controller not available; cannot navigate.');\r\n      return;\r\n    }\r\n\r\n    console.log('[LinesFP] clickLine:', label.name, 'groupId =', label.groupId);\r\n\r\n    var params = {};\r\n\r\n    // 1) Always send well-known `entityGroupId`\r\n    params.entityGroupId = label.groupId;\r\n\r\n    // 2) Also send under configured name if different\r\n    if (CONFIG.stateParamName && CONFIG.stateParamName !== 'entityGroupId') {\r\n      params[CONFIG.stateParamName] = label.groupId;\r\n    }\r\n\r\n    // 3) Extra metadata, useful in child states\r\n    params.entityGroupLabel = label.label || label.name || '';\r\n    params.entityGroupInternalId = label.id;\r\n\r\n    var currentStateId = sc.getStateId && sc.getStateId();\r\n    var nextStateId = CONFIG.targetStateId || null;\r\n\r\n    console.log(\r\n      '[LinesFP] Updating state. currentStateId =',\r\n      currentStateId,\r\n      ', nextStateId =',\r\n      nextStateId,\r\n      ', params =',\r\n      params\r\n    );\r\n\r\n    sc.updateState(nextStateId, params, false);\r\n  }\r\n\r\n  // ---------- INIT / RESIZE / DESTROY ----------\r\n\r\n  applyConfig();\r\n\r\n  self.onResize = function () {\r\n    recomputePixelPositions();\r\n  };\r\n\r\n  self.onDestroy = function () {\r\n    console.log('[LinesFP] Widget destroyed');\r\n  };\r\n};\r\n",
      "settingsForm" : [ {
        "id" : "imageUrl",
        "name" : "Background Image",
        "type" : "image",
        "default" : "tb-image;/api/images/tenant/floorplan.webp"
      }, {
        "id" : "linesConfig",
        "name" : "Lines (Entity Groups JSON)",
        "type" : "json",
        "default" : "[\n  {\n    \"id\": \"line_1\",\n    \"label\": \"Line 1\",\n    \"groupId\": \"5a89ea50-c9ca-11f0-a09c-911c53809081\",\n    \"x\": 30,\n    \"y\": 30\n  },\n  {\n    \"id\": \"line_2\",\n    \"label\": \"Line 2\",\n    \"groupId\": \"221d3090-9168-11f0-84d5-efc64010e13c\",\n    \"x\": 60,\n    \"y\": 50\n  }\n]"
      }, {
        "id" : "targetStateId",
        "name" : "Target State ID",
        "type" : "text",
        "default" : "machine_sld_view"
      }, {
        "id" : "stateParamName",
        "name" : "State Parameter Name (extra key)",
        "type" : "text",
        "default" : "entityGroupId"
      } ],
      "settingsDirective" : "",
      "defaultConfig" : "{\"datasources\":[{\"type\":\"static\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"rgb(255, 255, 255)\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"cardHtml\":\"<div class='card'>HTML code here</div>\",\"cardCss\":\".card {\\n    font-weight: bold;\\n    font-size: 32px;\\n    color: #999;\\n    width: 100%;\\n    height: 100%;\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n}\"},\"title\":\"HTML Card\",\"dropShadow\":true}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "0f65c530-c9ca-11f0-a09c-911c53809081"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}