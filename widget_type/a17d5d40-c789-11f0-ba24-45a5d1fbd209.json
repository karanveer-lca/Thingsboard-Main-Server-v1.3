{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "navigation_ribbon",
    "name" : "Navigation Ribbon",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "static",
      "sizeX" : 7.5,
      "sizeY" : 3,
      "resources" : [ ],
      "templateHtml" : "<div id=\"tb-state-nav-root\"\r\n     style=\"\r\n       width:100%;\r\n       height:100%;\r\n       background:#0f243e;\r\n       color:#e5edf7;\r\n       font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;\r\n       box-sizing:border-box;\r\n       padding:0 8px;\r\n       display:flex;\r\n       align-items:center;\r\n     \">\r\n\r\n  <!-- Single ribbon row -->\r\n  <div id=\"tb-state-row\"\r\n       style=\"\r\n         width:100%;\r\n         display:flex;\r\n         align-items:center;\r\n         justify-content:space-between;\r\n         gap:8px;\r\n       \">\r\n\r\n    <!-- Back (far left) -->\r\n    <div id=\"back-btn\"\r\n         style=\"\r\n           width:36px;\r\n           height:36px;\r\n           border-radius:999px;\r\n           border:2px solid rgba(229,237,247,0.5);\r\n           background:rgba(5,15,30,0.95);\r\n           display:flex;\r\n           align-items:center;\r\n           justify-content:center;\r\n           cursor:pointer;\r\n           box-shadow:0 0 0 1px rgba(0,0,0,0.25);\r\n           flex-shrink:0;\r\n         \">\r\n      <div style=\"\r\n        width:0;height:0;\r\n        border-top:7px solid transparent;\r\n        border-bottom:7px solid transparent;\r\n        border-right:10px solid #e5edf7;\r\n      \"></div>\r\n    </div>\r\n\r\n    <!-- Quick links center (scrollable) -->\r\n    <div style=\"\r\n          flex:1;\r\n          overflow-x:auto;\r\n          overflow-y:hidden;\r\n          display:flex;\r\n          justify-content:center;\r\n        \">\r\n      <div id=\"quick-links\"\r\n           style=\"\r\n             display:inline-flex;\r\n             align-items:center;\r\n             gap:6px;\r\n             padding:0 4px;\r\n             white-space:nowrap;\r\n           \">\r\n        <!-- JS will fill this -->\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Forward (far right) -->\r\n    <div id=\"forward-btn\"\r\n         style=\"\r\n           width:36px;\r\n           height:36px;\r\n           border-radius:999px;\r\n           border:2px solid rgba(229,237,247,0.5);\r\n           background:rgba(5,15,30,0.95);\r\n           display:flex;\r\n           align-items:center;\r\n           justify-content:center;\r\n           cursor:pointer;\r\n           box-shadow:0 0 0 1px rgba(0,0,0,0.25);\r\n           flex-shrink:0;\r\n         \">\r\n      <div style=\"\r\n        width:0;height:0;\r\n        border-top:7px solid transparent;\r\n        border-bottom:7px solid transparent;\r\n        border-left:10px solid #e5edf7;\r\n      \"></div>\r\n    </div>\r\n\r\n  </div>\r\n</div>\r\n",
      "templateCss" : "",
      "controllerScript" : "self.onInit = function () {\r\n  var ctx = self.ctx;\r\n\r\n  // ðŸ”¹ Global scalers\r\n  var NAV_UI_SCALE   = 1.5;  // quick-link pills & text\r\n  var ARROW_UI_SCALE = 1.3;  // arrow button & triangle size\r\n\r\n  function navPx(v)   { return (v * NAV_UI_SCALE) + 'px'; }\r\n  function arrowPx(v) { return (v * ARROW_UI_SCALE) + 'px'; }\r\n\r\n  var navStates = [\r\n    { id: \"plant_sld\",          label: \"SLD Plant View\" },\r\n    { id: \"machine_dashboard\",  label: \"Machine Dashboard\" },\r\n    { id: \"duration_header\",    label: \"Duration Header\" },\r\n    { id: \"occurrence_header\",  label: \"Occurrence Header\" },\r\n    { id: \"job_card\",           label: \"Job Card Panel\" },\r\n    { id: \"control_panel\",      label: \"Control Panel\" },\r\n    { id: \"ai_analysis\",        label: \"AI Analysis\" }\r\n  ];\r\n\r\n  var quickLinkButtons = {};\r\n\r\n  function getStateCtrl() {\r\n    return ctx.stateController || (ctx.dashboard && ctx.dashboard.stateController) || null;\r\n  }\r\n\r\n  function getCurrentStateId(stateCtrl) {\r\n    stateCtrl = stateCtrl || getStateCtrl();\r\n    if (!stateCtrl || typeof stateCtrl.getStateId !== 'function') return null;\r\n    try {\r\n      return stateCtrl.getStateId();\r\n    } catch (e) {\r\n      console.error('[StateNav] getStateId failed:', e);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  function findIndexById(stateId) {\r\n    if (!stateId) return -1;\r\n    for (var i = 0; i < navStates.length; i++) {\r\n      if (navStates[i].id === stateId) return i;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  function setBtnActive(btn, active) {\r\n    if (!btn) return;\r\n    if (active) {\r\n      btn.style.background  = '#e5edf7';\r\n      btn.style.color       = '#0f243e';\r\n      btn.style.borderColor = '#e5edf7';\r\n    } else {\r\n      btn.style.background  = 'rgba(8,22,43,0.95)';\r\n      btn.style.color       = '#e5edf7';\r\n      btn.style.borderColor = 'rgba(229,237,247,0.6)';\r\n    }\r\n  }\r\n\r\n  function highlightQuickLink(activeId) {\r\n    Object.keys(quickLinkButtons).forEach(function (id) {\r\n      setBtnActive(quickLinkButtons[id], id === activeId);\r\n    });\r\n  }\r\n\r\n  // ðŸ”¹ Read jobcard + param key from state params\r\n  function getJobcardFromStateParams() {\r\n    var stateCtrl = getStateCtrl();\r\n    if (!stateCtrl || typeof stateCtrl.getStateParams !== 'function') {\r\n      return null;\r\n    }\r\n\r\n    var params;\r\n    try {\r\n      params = stateCtrl.getStateParams();\r\n    } catch (e) {\r\n      console.error('[StateNav] getStateParams failed:', e);\r\n      return null;\r\n    }\r\n\r\n    console.log('[StateNav] current state params:', params);\r\n    if (!params) return null;\r\n\r\n    var key = null;\r\n    if (params.targetEntityParamName && params[params.targetEntityParamName]) {\r\n      key = params.targetEntityParamName;\r\n    } else if (params.jobcard) {\r\n      key = 'jobcard';\r\n    } else {\r\n      return null;\r\n    }\r\n\r\n    var job = params[key];\r\n    if (!job) return null;\r\n\r\n    return { key: key, job: job };\r\n  }\r\n\r\n  // ðŸ”¹ Update the current state (no stacking) + forward jobcard + optional machineId\r\n  function goToState(targetId) {\r\n    var stateCtrl = getStateCtrl();\r\n    if (!stateCtrl) {\r\n      console.warn('[StateNav] No state controller available');\r\n      return;\r\n    }\r\n\r\n    var jc = getJobcardFromStateParams();\r\n    var paramsToPass = {};\r\n\r\n    if (jc && jc.job) {\r\n      // forward jobcard param as-is\r\n      paramsToPass.targetEntityParamName = jc.key;\r\n      paramsToPass[jc.key] = jc.job;\r\n\r\n      // jobcard.entityLabel = deviceId (from SLD widget)\r\n      // jobcard.entityName  = machine name\r\n      var deviceId   = jc.job.entityLabel || null;\r\n      var deviceName = jc.job.entityName || jc.job.entityLabel || '';\r\n\r\n      // For header states, add machineId param as full entity descriptor\r\n      if ((targetId === 'duration_header' || targetId === 'occurrence_header') && deviceId) {\r\n        paramsToPass.machineId = {\r\n          entityId:    { entityType: 'DEVICE', id: deviceId },\r\n          entityName:  deviceName,\r\n          entityLabel: deviceName\r\n        };\r\n        console.log('[StateNav] machineId param set to entity:', paramsToPass.machineId);\r\n      } else if (targetId === 'duration_header' || targetId === 'occurrence_header') {\r\n        console.warn('[StateNav] No deviceId on jobcard; machineId entity not set');\r\n      }\r\n    } else {\r\n      if (targetId === 'duration_header' || targetId === 'occurrence_header') {\r\n        console.warn('[StateNav] No jobcard param present; cannot set machineId');\r\n      }\r\n    }\r\n\r\n    var nextStateId = targetId || null;\r\n    console.log('[StateNav] Updating state to:', nextStateId, 'with params:', paramsToPass);\r\n\r\n    if (typeof stateCtrl.updateState === 'function') {\r\n      // Replace current state (id + params) without nesting\r\n      stateCtrl.updateState(nextStateId, paramsToPass, false);\r\n    } else {\r\n      console.warn('[StateNav] stateCtrl.updateState is not available; no URL-safe update possible.');\r\n      // If you *really* want a fallback, you could call setState here,\r\n      // but that may still affect URL depth depending on TB version.\r\n      if (typeof stateCtrl.setState === 'function') {\r\n        stateCtrl.setState(nextStateId, paramsToPass, false);\r\n      }\r\n    }\r\n\r\n    highlightQuickLink(targetId);\r\n  }\r\n\r\n  function navigateRelative(offset) {\r\n    var stateCtrl = getStateCtrl();\r\n    if (!stateCtrl) return;\r\n\r\n    var currentId  = getCurrentStateId(stateCtrl);\r\n    var currentIdx = findIndexById(currentId);\r\n    if (currentIdx < 0) return;\r\n\r\n    var newIdx = currentIdx + offset;\r\n    if (newIdx < 0) newIdx = navStates.length - 1;\r\n    else if (newIdx >= navStates.length) newIdx = 0;\r\n\r\n    goToState(navStates[newIdx].id);\r\n  }\r\n\r\n  function renderQuickLinks() {\r\n    var root      = ctx.$container && ctx.$container[0] ? ctx.$container[0] : document;\r\n    var container = root.querySelector('#quick-links');\r\n    if (!container) {\r\n      console.warn('[StateNav] #quick-links not found');\r\n      return;\r\n    }\r\n\r\n    container.innerHTML = '';\r\n    quickLinkButtons = {};\r\n\r\n    navStates.forEach(function (st) {\r\n      var btn = document.createElement('div');\r\n      btn.textContent = st.label;\r\n      btn.setAttribute('data-state-id', st.id);\r\n\r\n      // ðŸ”¹ NAV scale applied here\r\n      btn.style.display      = 'inline-block';\r\n      btn.style.padding      = navPx(4) + ' ' + navPx(14);\r\n      btn.style.margin       = '0 4px';\r\n      btn.style.borderRadius = '999px';\r\n      btn.style.border       = '1px solid rgba(229,237,247,0.6)';\r\n      btn.style.background   = 'rgba(8,22,43,0.95)';\r\n      btn.style.color        = '#e5edf7';\r\n      btn.style.fontSize     = navPx(13);\r\n      btn.style.fontWeight   = '600';\r\n      btn.style.whiteSpace   = 'nowrap';\r\n      btn.style.cursor       = 'pointer';\r\n      btn.style.boxShadow    = '0 0 0 1px rgba(0,0,0,0.35)';\r\n      btn.style.userSelect   = 'none';\r\n\r\n      btn.addEventListener('click', function () {\r\n        console.log('[StateNav] Quick link:', st.id);\r\n        goToState(st.id);\r\n      });\r\n\r\n      container.appendChild(btn);\r\n      quickLinkButtons[st.id] = btn;\r\n    });\r\n  }\r\n\r\n  function styleArrowButton(btnId, isLeft) {\r\n    var root = ctx.$container && ctx.$container[0] ? ctx.$container[0] : document;\r\n    var btn  = root.querySelector('#' + btnId);\r\n    if (!btn) return;\r\n\r\n    btn.style.width        = arrowPx(36);\r\n    btn.style.height       = arrowPx(36);\r\n    btn.style.borderRadius = '999px';\r\n\r\n    var arrow = btn.firstElementChild;\r\n    if (!arrow) return;\r\n\r\n    arrow.style.width  = '0';\r\n    arrow.style.height = '0';\r\n    arrow.style.borderTop    = arrowPx(7)  + ' solid transparent';\r\n    arrow.style.borderBottom = arrowPx(7)  + ' solid transparent';\r\n\r\n    if (isLeft) {\r\n      arrow.style.borderRight = arrowPx(10) + ' solid #e5edf7';\r\n      arrow.style.borderLeft  = '0';\r\n    } else {\r\n      arrow.style.borderLeft  = arrowPx(10) + ' solid #e5edf7';\r\n      arrow.style.borderRight = '0';\r\n    }\r\n  }\r\n\r\n  function bindArrows() {\r\n    var root    = ctx.$container && ctx.$container[0] ? ctx.$container[0] : document;\r\n    var backBtn = root.querySelector('#back-btn');\r\n    var fwdBtn  = root.querySelector('#forward-btn');\r\n\r\n    if (backBtn) {\r\n      backBtn.addEventListener('click', function () {\r\n        navigateRelative(-1);\r\n      });\r\n    }\r\n    if (fwdBtn) {\r\n      fwdBtn.addEventListener('click', function () {\r\n        navigateRelative(1);\r\n      });\r\n    }\r\n\r\n    styleArrowButton('back-btn', true);\r\n    styleArrowButton('forward-btn', false);\r\n  }\r\n\r\n  function syncActiveFromState() {\r\n    var stateCtrl = getStateCtrl();\r\n    if (!stateCtrl) return;\r\n    var curId = getCurrentStateId(stateCtrl);\r\n    highlightQuickLink(curId);\r\n  }\r\n\r\n  setTimeout(function () {\r\n    renderQuickLinks();\r\n    bindArrows();\r\n    syncActiveFromState();\r\n  }, 0);\r\n};\r\n\r\nself.onDataUpdated = function () {};\r\nself.onResize      = function () {};\r\nself.onDestroy     = function () {};\r\n",
      "settingsForm" : [ ],
      "settingsDirective" : "",
      "defaultConfig" : "{\"datasources\":[{\"type\":\"static\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"rgb(255, 255, 255)\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"cardHtml\":\"<div class='card'>HTML code here</div>\",\"cardCss\":\".card {\\n    font-weight: bold;\\n    font-size: 32px;\\n    color: #999;\\n    width: 100%;\\n    height: 100%;\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n}\"},\"title\":\"HTML Card\",\"dropShadow\":true}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "a17d5d40-c789-11f0-ba24-45a5d1fbd209"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}